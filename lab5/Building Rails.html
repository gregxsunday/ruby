<!DOCTYPE html>
<!-- saved from url=(0178)https://webcache.googleusercontent.com/search?q=cache:y0n3Tk-G9P0J:https://buildingrails.com/a/rails_functional_testing_controllers_for_beginners_part_2+&cd=2&hl=en&ct=clnk&gl=pl -->
<html class="no-js gr__webcache_googleusercontent_com"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!--<base href="https://buildingrails.com/a/rails_functional_testing_controllers_for_beginners_part_2">--><base href="."><style>body{margin-left:0;margin-right:0;margin-top:0}#bN015htcoyT__google-cache-hdr{background:#f5f5f5;font:13px arial,sans-serif;text-align:left;color:#202020;border:0;margin:0;border-bottom:1px solid #cecece;line-height:16px;padding:16px 28px 24px 28px}#bN015htcoyT__google-cache-hdr *{display:inline;font:inherit;text-align:inherit;color:inherit;line-height:inherit;background:none;border:0;margin:0;padding:0;letter-spacing:0}#bN015htcoyT__google-cache-hdr a{text-decoration:none;color:#1a0dab}#bN015htcoyT__google-cache-hdr a:hover{text-decoration:underline}#bN015htcoyT__google-cache-hdr a:visited{color:#609}#bN015htcoyT__google-cache-hdr div{display:block;margin-top:4px}#bN015htcoyT__google-cache-hdr b{font-weight:bold;display:inline-block;direction:ltr}</style><script async="" src="./Building Rails_files/analytics.js.pobrane"></script><script type="text/javascript" async="" src="./Building Rails_files/embed.js.pobrane"></script><link rel="preload" as="style" href="https://c.disquscdn.com/next/embed/styles/lounge.694ea7181ea49f1ce306dfc00c532f53.css"><link rel="preload" as="script" href="https://c.disquscdn.com/next/embed/common.bundle.2b6bb3725200b8d992a8cb9c288952d3.js"><link rel="preload" as="script" href="https://c.disquscdn.com/next/embed/lounge.bundle.e04d6946f2fad54035486025e9a4979a.js"><link rel="preload" as="script" href="https://disqus.com/next/config.js"></head><body data-gr-c-s-loaded="true"><div id="bN015htcoyT__google-cache-hdr"><div><span>This is Google's cache of <a href="https://buildingrails.com/a/rails_functional_testing_controllers_for_beginners_part_2">https://buildingrails.com/a/rails_functional_testing_controllers_for_beginners_part_2</a>.</span>&nbsp;<span>It is a snapshot of the page as it appeared on 8 Apr 2019 22:36:38 GMT.</span>&nbsp;<span>The <a href="https://buildingrails.com/a/rails_functional_testing_controllers_for_beginners_part_2">current page</a> could have changed in the meantime.</span>&nbsp;<a href="http://support.google.com/websearch/bin/answer.py?hl=en&amp;p=cached&amp;answer=1687222"><span>Learn more</span>.</a></div><div><span style="display:inline-block;margin-top:8px;margin-right:104px;white-space:nowrap"><span style="margin-right:28px"><span style="font-weight:bold">Full version</span></span><span style="margin-right:28px"><a href="http://webcache.googleusercontent.com/search?q=cache:y0n3Tk-G9P0J:https://buildingrails.com/a/rails_functional_testing_controllers_for_beginners_part_2&amp;hl=en&amp;gl=pl&amp;strip=1&amp;vwsrc=0"><span>Text-only version</span></a></span><span style="margin-right:28px"><a href="http://webcache.googleusercontent.com/search?q=cache:y0n3Tk-G9P0J:https://buildingrails.com/a/rails_functional_testing_controllers_for_beginners_part_2&amp;hl=en&amp;gl=pl&amp;strip=0&amp;vwsrc=1"><span>View source</span></a></span></span></div><span style="display:inline-block;margin-top:8px;color:#717171"><span>Tip: To quickly find your search term on this page, press <b>Ctrl+F</b> or <b>⌘-F</b> (Mac) and use the find bar.</span></span></div><div style="position:relative;">
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->  <!--<![endif]-->

    <title>Building Rails</title>
    <link rel="stylesheet" media="all" href="./Building Rails_files/application-cec688b5d8625a3c9c88c5179add210b.css" data-turbolinks-track="true">
    <script src="./Building Rails_files/application-f53f7930a12a6fdd18910d345dcd0535.js.pobrane" data-turbolinks-track="true"></script>
    <meta name="csrf-param" content="authenticity_token">
<meta name="csrf-token" content="+ar3TOurWvAStkNr8dgqh6h+B/epyvwTyRowsKxLuNWbkyQh+S5HClD+3lLwyoECbNnomLwrX2rUvwksgQLpww==">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="https://buildingrails.com/display/feed.rss">
    
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">


    <header>
        <div class="widewrapper masthead">
            <div class="container">
                <a href="https://buildingrails.com/" id="logo">
                  <h1 class="head_title">Building Rails</h1>
                </a>

                <div id="mobile-nav-toggle" class="pull-right">
                    <a href="https://buildingrails.com/a/rails_functional_testing_controllers_for_beginners_part_2#" data-toggle="collapse" data-target=".tales-nav .navbar-collapse">
                        <i class="fa fa-bars"></i>
                    </a>
                </div>


                <nav class="pull-right tales-nav">
                    <div class="collapse navbar-collapse">
                        <ul class="nav nav-pills navbar-nav">

                            <li>
                              <a href="https://buildingrails.com/">Home</a>
                            </li>
                            <li>
                              <a href="https://buildingrails.com/articles">Articles</a>
                            </li>
                            <li>
                              <a href="https://buildingrails.com/display/about">About</a>
                            </li>
                        </ul>
                    </div>
                </nav>        

            </div>
        </div>

    </header>
    <div class="widewrapper main">
    <div id="core_container" class="container">
        <div class="row">
            <div class="col-md-8 blog-main">
                <h1>Rails Functional Testing Controllers for Beginners - Part 2</h1>
  <div class="meta clearfix">
    <div class="create_date">
        Published:
        <i class="fa fa-calendar"></i>
        <span class="data">2014-09-17</span>
    </div>
    <!-- <div class="update_date"> -->
    <!--     <strong>Last Updated:</strong> -->
    <!--     <i class="fa fa&#45;calendar"></i> -->
    <!--     <span class="data">2014-09-17</span> -->
    <!-- </div> -->
  </div>
  This article is <a href="http://buildingrails.com/a/rails_functional_testing_controllers_for_beginners_part_1">continuing on from Part 1</a> and dives further into writing functional tests for your controllers. 
<p></p>
<p>
Here are the common tests that I use when writing functional tests for my Rails controllers.
</p>
<p>
First make sure you have some form of <a href="http://buildingrails.com/a/rails_automated_testing_setup_for_beginners">automated testing setup</a> as per my previous article. This will allow your tests to automatically run whenever you modify your test or model file. This will save a lot of time. If you have notifications setup, even better, you can just wait for the alert to pop up.
</p>
<p>
<strong>NOTE:</strong> The following versions were used for this setup:
</p><ul>
  <li>
  Rails: 4.1.5
  </li>
  <li>
  Ruby 2.1.2
  </li>
  <li>
  MiniTest 5.4.0
  </li>
</ul>
<p></p>

<h2>Testing for Divs in Views</h2>
<p>
Generally you will probably have views that will be showing different content on the same page depending on what actions are taken. In this case its great to be able to check for the presence of unique ID's that should or should NOT be there.
</p>
<p>
The trick is to use unique ID tags for your divs in your views so you can easily check for them in your tests. Here is an example of the ID tag.
</p>
<p>
</p><div class="CodeRay">
  <div class="code"><pre><span class="tag">&lt;div</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">product_admin</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
Admin Content goes here.
<span class="tag">&lt;/div&gt;</span>
<span class="tag">&lt;div</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">product</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
Regular Content goes here.
<span class="tag">&lt;/div&gt;</span>
</pre></div>
</div>

<p></p>
<p>
This is also great for testing to make sure that admin content only appears to an admin and not a regular user.
</p>
<p>
Here is how to do the functional test:
</p><div class="CodeRay">
  <div class="code"><pre>test <span class="string"><span class="delimiter">"</span><span class="content">should get show as regular user</span><span class="delimiter">"</span></span> <span class="keyword">do</span>
  <span class="comment"># this is based off devise, this is a regular user</span>
  sign_in users(<span class="symbol">:regular</span>) 
  get <span class="symbol">:index</span>, <span class="key">product_id</span>: <span class="integer">1</span>
  assert_response <span class="symbol">:success</span>
  <span class="comment"># regular users can't see the admin panel</span>
  assert_select <span class="string"><span class="delimiter">"</span><span class="content">#product_admin</span><span class="delimiter">"</span></span>, <span class="key">count</span>: <span class="integer">0</span>
  <span class="comment"># regular users can see the admin panel</span>
  assert_select <span class="string"><span class="delimiter">"</span><span class="content">#product</span><span class="delimiter">"</span></span>, <span class="key">count</span>: <span class="integer">1</span>
<span class="keyword">end</span>
test <span class="string"><span class="delimiter">"</span><span class="content">should get show as admin user</span><span class="delimiter">"</span></span> <span class="keyword">do</span>
  <span class="comment"># this is based off devise, this is an admin user.</span>
  sign_in users(<span class="symbol">:admin</span>) 
  get <span class="symbol">:index</span>, <span class="key">company_id</span>: <span class="integer">1</span>
  assert_response <span class="symbol">:success</span>
  <span class="comment"># admin users can see both panels</span>
  assert_select <span class="string"><span class="delimiter">"</span><span class="content">#product_admin</span><span class="delimiter">"</span></span>, <span class="key">count</span>: <span class="integer">1</span>
  assert_select <span class="string"><span class="delimiter">"</span><span class="content">#product</span><span class="delimiter">"</span></span>, <span class="key">count</span>: <span class="integer">1</span>
<span class="keyword">end</span>
</pre></div>
</div>

As you can see, this is a simple little test that can be very handy to verify the presence of certain elements on your page.
<p></p>
<h2>Simple AJAX Javascript testing</h2>
<p>
While javascript testing is a whole chapter by itself, there is a basic test that you can do to ensure that your javascript views are at least being sent to the browser without any errors. 
</p>
<p>
</p><div class="CodeRay">
  <div class="code"><pre>test <span class="string"><span class="delimiter">"</span><span class="content">update product via javascript</span><span class="delimiter">"</span></span> <span class="keyword">do</span>
  <span class="comment"># use xhr to simulate a ajax call</span>
  xhr <span class="symbol">:get</span>, <span class="symbol">:product_update</span>, <span class="key">format</span>: <span class="symbol">:js</span>, <span class="key">product_id</span>: <span class="string"><span class="delimiter">'</span><span class="content">77</span><span class="delimiter">'</span></span>
  <span class="comment"># if the controller responds with a javascript file the response will be a success</span>
  assert_response <span class="symbol">:success</span>
<span class="keyword">end</span>
</pre></div>
</div>

As you can see, an effective way to test that your .js views are responding correctly.
<p></p>
<h2>Testing the actual content of views</h2>
<p>
If you are going to do a refactor of the logic in your application views, then you can check the actual rendered content of views is still correct using <em>assert_select</em>.
</p>

<p>
Here is the view:
</p><div class="CodeRay">
  <div class="code"><pre><span class="comment"># app/views/products/show.html.erb</span>
&lt;div id=<span class="string"><span class="delimiter">"</span><span class="content">post_content</span><span class="delimiter">"</span></span>&gt;
  &lt;p&gt;
    &lt;strong&gt;<span class="key">Name</span>:&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">strong&gt;
    &lt;%= @product.title %&gt;
  &lt;</span><span class="delimiter">/</span></span>p&gt;

  &lt;p&gt;
    &lt;strong&gt;<span class="key">Description</span>:&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">strong&gt;
    &lt;%= @product.description %&gt;
  &lt;</span><span class="delimiter">/</span></span>p&gt;
&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">div&gt;
</span></span></pre></div>
</div>

<p></p>

<p>
Here is the test of the view contents:
</p><div class="CodeRay">
  <div class="code"><pre>test <span class="string"><span class="delimiter">"</span><span class="content">should show content of product page correctly</span><span class="delimiter">"</span></span> <span class="keyword">do</span>
  <span class="comment"># do a standard get of the product</span>
  get <span class="symbol">:show</span>, <span class="key">id</span>: products(<span class="symbol">:one</span>)
  assert_response <span class="symbol">:success</span>
  <span class="comment">#check that the content matches</span>
  assert_select <span class="string"><span class="delimiter">'</span><span class="content">#product_content</span><span class="delimiter">'</span></span>, <span class="key">html</span>: <span class="string"><span class="delimiter">'</span><span class="content">&lt;p&gt;
    &lt;strong&gt;Name:&lt;/strong&gt;
    MyString
  &lt;/p&gt;

  &lt;p&gt;
    &lt;strong&gt;Description:&lt;/strong&gt;
    MyText
  &lt;/p&gt;</span><span class="delimiter">'</span></span>
</pre></div>
</div>

Now you can refactor your view/controller and be assured that the final output is unmodified from what it was originally.
<p></p>
<h2>Where to start</h2>
<p>
If you already have a Rails application working and don't have any tests, its easy to get started. The basic scaffold tests for your controllers are a great way to get started and you can slowly build up from there. 
</p>

<h2>Your own tests</h2>
<p>As you can see, it is easy to get started writing tests that you can rely on to ensure your application is working. You can slowly build up your test suite over time.</p>
<p>
Hopefully this has helped you to get more confident with writing tests that you can rely on.
</p>

<h2>Resources</h2>
<p>
<a href="http://guides.rubyonrails.org/testing.html">RailsGuides for Testing</a> -
The Rails Guides guide to testing applications.
</p>
<p>
<a href="http://api.rubyonrails.org/classes/ActionDispatch/Assertions/SelectorAssertions.html">Assert Select Documentation</a> - For a deeper dive into assert select and what it can do.
</p>
<p>
<a href="http://buildingrails.com/a/rails_automated_testing_setup_for_beginners">Rails Automated Testing Setup for Beginners</a> -
The first article on how to setup automated testing in Rails.
</p>
<p>
<a href="http://buildingrails.com/a/rails_unit_testing_with_minitest_for_beginners">Rails Unit Testing with MiniTest for Beginners</a> - Getting started testing your Rails application with Unit testing using MiniTest. Also includes fixtures.
</p>

<p>
<a href="http://buildingrails.com/a/rails_functional_testing_controllers_for_beginners_part_1">Rails Functional Testing Controllers for Beginners - Part 1</a> -
The previous article on how to setup functional controller tests in Rails.
</p>

<br>
<br>

<div class="sharing meta clearfix">
  <div class="comment">
    Share this article:
  </div>
  <div class="shareicon">
      <a href="https://twitter.com/intent/tweet?via=adam21e&amp;text=Rails%20Functional%20Testing%20Controllers%20for%20Beginners%20-%20Part%202%20https%3A%2F%2Fbuildingrails.com%2Fa%2Frails_functional_testing_controllers_for_beginners_part_2">
        <span class="fa-stack fa-lg">
          <i class="fa fa-circle fa-stack-2x lightblue"></i>
          <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
      </span></a>
  </div>
  <div class="shareicon">
    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fbuildingrails.com%2Fa%2Frails_functional_testing_controllers_for_beginners_part_2">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x mediumblue"></i>
        <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
      </span></a>
  </div>
  <div class="shareicon">
    <a href="https://plus.google.com/share?url=https%3A%2F%2Fbuildingrails.com%2Fa%2Frails_functional_testing_controllers_for_beginners_part_2">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x darkorange"></i>
        <i class="fa fa-google-plus fa-stack-1x fa-inverse"></i>
      </span></a>
  </div>
</div>


<div id="disqus_thread"><iframe id="dsq-app7134" name="dsq-app7134" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" width="100%" src="./Building Rails_files/saved_resource.html" style="width: 1px !important; min-width: 100% !important; border: none !important; overflow: hidden !important; height: 662px !important;" horizontalscrolling="no" verticalscrolling="no"></iframe></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'buildingrails'; // required: replace example with your forum shortname
    var disqus_identifier = 'rails_functional_testing_controllers_for_beginners_part_2';
    var disqus_title = 'Rails Functional Testing Controllers for Beginners - Part 2';
    var disqus_url = 'https://buildingrails.com/a/rails_functional_testing_controllers_for_beginners_part_2';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    

            </div>
            <aside class="col-md-4 blog-aside">
                <div class="aside-widget">
                <header>
                    <h3>Get regular articles to help you build your Rails site</h3>
                </header>
                <!-- Begin MailChimp Signup Form -->
                  <div id="mc_embed_signup" class="body">
                  <form action="https://buildingrails.us8.list-manage.com/subscribe/post?u=ccd9a603c30c5ad78a6912685&amp;id=7d80455721" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" novalidate="">
                  <div class="mc-field-group">
                    <label for="mce-FNAME">First Name </label>
                    <input type="text" value="" name="FNAME" class="" id="mce-FNAME">
                  </div>
                  <div class="mc-field-group">
                    <label for="mce-EMAIL">Email Address  <span class="asterisk">*</span>
                  </label>
                    <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
                  </div>
                    <div id="mce-responses" class="clear">
                      <div class="response" id="mce-error-response" style="display:none"></div>
                      <div class="response" id="mce-success-response" style="display:none"></div>
                    </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
                      <div style="position: absolute; left: -5000px;"><input type="text" name="b_ccd9a603c30c5ad78a6912685_7d80455721" tabindex="-1" value=""></div>
                      <div class="clear"><input type="submit" value="Get Regular updates" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
                  </form>
                  </div>
                  <!--End mc_embed_signup-->
                <div class="body">
                   <a href="https://buildingrails.com/display/feed.rss"><i class="fa fa-rss fa-lg"></i> RSS Feed</a>
                </div>
                </div>
            </aside>
        </div>
    </div>
</div>
  <div id="waiting" class="hidden">
    <div id="progressbar"><img src="./Building Rails_files/ajax-loader-59bca5f71ec346fafd19d8c17d5d3ec6.gif" alt="Ajax loader"></div>
  </div>

      <footer>
        <div class="widewrapper footer">
            <div class="container">
                <div class="row">
                    <div class="col-md-4 footer-widget">
                      <h3> <i class="fa fa-star"></i>Links</h3>
                      <div class="line">
                        <span> <a href="https://buildingrails.com/"><i class="fa fa-home fa-lg"></i> Home Page</a> </span>
                      </div>
                      <div class="line">
                        <span> <a href="https://buildingrails.com/articles"><i class="fa fa-list fa-lg"></i> Articles</a> </span>
                      </div>
                    </div>

                    <div class="col-md-4 footer-widget">
                    </div>

                    <div class="col-md-4 footer-widget">
                        <h3> Contact Me</h3>

                        <span>Thoughts, feedback, critique, suggestions? Contact me at:</span>

                        <span id="contactemail" class="email">
                            <i class="fa fa-envelope fa-lg"></i> adam (at) buildingrails.com
                        </span>
                        <span class="email">
                           <a href="https://twitter.com/@adam21e"><i class="fa my-fa-twitter fa-lg"></i> Twitter @adam21e</a>
                        </span>
                    </div>
                </div>
            </div>
        </div>
        <div class="widewrapper copyright">
            <div class="container">
              © 2014 Adam Wilson
            </div>
        </div>
    </footer>
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-51590729-1', 'buildingrails.com');
ga('send', 'pageview');

</script>



</div><iframe style="display: none;" src="./Building Rails_files/saved_resource(1).html"></iframe></body></html>